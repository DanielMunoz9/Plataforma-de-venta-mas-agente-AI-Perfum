{% extends 'base.html' %}

{% block title %}{{ categoria }} - LIZO Belleza{% endblock %}

{% block content %}
<div class="container my-5">
  <h2 class="text-center mb-4">{{ categoria.nombre }}</h2>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">

    {% for producto in productos %}
    <div class="col">
      <div class="card h-100 shadow-sm">

        <!-- Imagen con lupa -->
        <div class="zoom-container" data-img="{{ url_for('admin_producto_bp.obtener_imagen_producto', id=producto.id) }}">
          <div class="img-wrapper">
            <img src="{{ url_for('admin_producto_bp.obtener_imagen_producto', id=producto.id) }}"
                 class="card-img-top zoom-image"
                 alt="{{ producto.nombre }}">
            <div class="zoom-lens"></div>
          </div>
          <div class="zoom-icon"><i class="fas fa-search-plus"></i></div>
        </div>

        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-center">{{ producto.nombre }}</h5>

          <!-- Lista desde descripción con viñetas -->
          <ul class="text-start small">
            {% for linea in producto.descripcion.split('•') if linea.strip() %}
            <li>• {{ linea.strip() }}</li>
            {% endfor %}
          </ul>

          <p class="text-danger fw-bold text-center mt-auto">
            $ {{ "{:,.0f}".format(producto.precio) }}
          </p>

          <!-- Botón Ver Detalles -->
          <a href="{{ url_for('html_views.detalle_producto', id=producto.id) }}"
             class="btn btn-primary mt-2">
            Ver detalles
          </a>
        </div>
      </div>
    </div>
    {% endfor %}

    {% if productos|length == 0 %}
    <div class="col-12">
      <p class="text-center text-muted">No hay productos disponibles en esta categoría.</p>
    </div>
    {% endif %}
  </div>
</div>

<!-- Estilos -->
<style>
  .zoom-container {
    position: relative;
    cursor: crosshair;
  }

  .img-wrapper {
    position: relative;
    width: 100%;
    height: 230px;
    overflow: hidden;
  }

  .zoom-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .zoom-lens {
    position: absolute;
    border: 2px solid #000;
    width: 100px;        /* Ajusta el tamaño del lente */
    height: 100px;
    visibility: hidden;
    background: no-repeat;
    pointer-events: none;
    border-radius: 50%;  /* Si quieres lente redondo */
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
  }

  .zoom-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    color: white;
    opacity: 0;
    transition: 0.3s;
    pointer-events: none;
  }

  .zoom-container:hover .zoom-icon {
    opacity: 1;
    background-color: rgba(0, 0, 0, 0.4);
    padding: 0.5rem;
    border-radius: 50%;
  }

  .card ul {
    padding-left: 1rem;
  }

  .card ul li {
    margin-bottom: 0.3rem;
  }
</style>

<!-- Script de Zoom con lupa reducido al lente -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.zoom-container').forEach(container => {
    const image = container.querySelector('.zoom-image');
    const lens = container.querySelector('.zoom-lens');
    const imgSrc = container.getAttribute('data-img');
    const zoomLevel = 2;  // Ajusta el nivel de zoom

    lens.style.backgroundImage = `url('${imgSrc}')`;

    const moveLens = e => {
      const rect = image.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      let lensX = x - lens.offsetWidth / 2;
      let lensY = y - lens.offsetHeight / 2;

      // Limites
      lensX = Math.max(0, Math.min(lensX, image.width - lens.offsetWidth));
      lensY = Math.max(0, Math.min(lensY, image.height - lens.offsetHeight));

      lens.style.left = lensX + 'px';
      lens.style.top = lensY + 'px';

      const bgX = -lensX * zoomLevel + lens.clientWidth / 2;
      const bgY = -lensY * zoomLevel + lens.clientHeight / 2;
      lens.style.backgroundSize = `${image.width * zoomLevel}px ${image.height * zoomLevel}px`;
      lens.style.backgroundPosition = `${bgX}px ${bgY}px`;
    };

    container.addEventListener('mouseenter', () => {
      lens.style.visibility = 'visible';
    });
    container.addEventListener('mousemove', moveLens);
    container.addEventListener('mouseleave', () => {
      lens.style.visibility = 'hidden';
    });
  });
});
</script>

<!-- Font Awesome para lupa -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

{% endblock %}
